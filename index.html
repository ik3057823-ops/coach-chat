<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coach Chat â€” Vocabulary Practice</title>
<style>
  :root{ --bg:#fff; --ink:#111827; --ink-dim:#6b7280; --brand:#2563eb; --soft:#f3f4f6; --soft-2:#e5e7eb; --radius:16px; --ok:#16a34a; --bad:#dc2626;}
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:880px;margin:0 auto;padding:16px}
  .card{background:#fff;border:1px solid var(--soft-2);border-radius:var(--radius);box-shadow:0 6px 24px rgba(0,0,0,.05);overflow:hidden}
  .header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--soft-2)}
  .title{margin:0;font-weight:700}
  .badge{font-size:12px;border-radius:999px;padding:2px 8px;color:#fff}
  .ok{background:var(--ok)} .bad{background:var(--bad)} .warn{background:#f59e0b}
  .chat{height:min(60vh,560px);overflow:auto;padding:16px;background:var(--soft)}
  .bubble{max-width:78%;padding:12px 14px;border-radius:14px;margin:8px 0;line-height:1.35;font-size:15px;word-wrap:break-word}
  .bot{background:#fff;border:1px solid var(--soft-2);border-top-left-radius:4px}
  .user{background:#2563eb;color:#fff;border-top-right-radius:4px;margin-left:auto}
  .footer{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;border-top:1px solid var(--soft-2);background:#fff;font-size:13px;color:var(--ink-dim)}
  .inputbar{display:flex;gap:10px;padding:12px;border-top:1px solid var(--soft-2);background:#fff}
  .inputbar input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--soft-2);font-size:15px}
  .btn{appearance:none;border:1px solid var(--soft-2);background:var(--brand);color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
  .results{padding:28px;text-align:center}
  .hidden{display:none}
</style>
<script defer>
(function(){
  "use strict";

  // ===== CONFIG =====
  const AI_API_URL = "https://coach-backend1.vercel.app/api/coach";

  // ===== ERROR TRAP (prints to chat) =====
  window.addEventListener("error", (e)=>{
    const chat = document.getElementById("chat");
    if (!chat) return;
    const b = document.createElement("div");
    b.className = "bubble bot";
    b.style.color = "#dc2626"; b.style.borderColor = "#dc2626";
    b.textContent = "Script error: " + (e.message || e.error || "Unknown");
    chat.appendChild(b);
  });

  // ===== DATA =====
  const WORDS = [
    { word:"diet", def:"The usual food and drink a person eats; also a controlled eating plan." },
    { word:"junk food", def:"Food high in sugar, salt, or fat and low in nutrients." },
    { word:"whole food", def:"Food that is minimally processed and close to its natural form." },
    { word:"food security", def:"Reliable access to enough safe and nutritious food to live a healthy life." },
    { word:"takeaway", def:"Food prepared by a restaurant to be eaten elsewhere (takeout).", alt:["take-out","take out","take away"] },
    { word:"processed", def:"Food changed from its natural state (e.g., adding salt, sugar, preservatives)." },
    { word:"perishable", def:"Food that spoils quickly without refrigeration." },
    { word:"wholesome", def:"Good for health; pure, simple, and nourishing." },
    { word:"organic", def:"Grown or made without most synthetic pesticides or fertilizers." },
    { word:"nutritious", def:"Nourishing; provides useful nutrients like vitamins and minerals." },
    { word:"consume", def:"To eat or drink; also to use up." },
    { word:"tempted", def:"Feeling a strong desire to do something you maybe shouldn't.", base:"tempt" },
    { word:"reduce", def:"To make smaller or less in amount, size, or number." },
    { word:"sample", def:"To try a small amount to test taste or quality." },
    { word:"digest", def:"To break down food in the body so it can be absorbed and used." }
  ];

  // ===== STATE =====
  let queue=[], wrongQueue=[], cur=null, task=null;
  let stats={correct:0, wrong:0}, history=[];

  // ===== DOM =====
  const $ = (s)=>document.querySelector(s);
  const chat = $("#chat");
  const msg  = $("#msg");
  const progress = $("#progress");
  const score = $("#score");
  const hint = $("#hint");
  const sendBtn = $("#sendBtn");
  const app = $("#app");
  const results = $("#results");

  function bubble(sender, text){
    const b = document.createElement("div");
    b.className = "bubble " + (sender==="bot"?"bot":"user");
    b.textContent = text;
    chat.appendChild(b); chat.scrollTop = chat.scrollHeight;
  }
  function shuffle(a){ a=a.slice(); for(le
